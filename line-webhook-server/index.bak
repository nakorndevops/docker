//import { checkUserExists } from './module/userdb-api-client.js';
//import { checkActiveUser } from './module/checkActiveUser.js';
//import { getLicenseIdFromLineUserID } from './module/getLicenseIdFromLineUserID.js';
//import { LineReply } from './module/LineReply.js';

import * as fs from "fs";

import express from "express";
const app = express();
app.use(express.json());

import * as https from "https";
const options = {
  key: fs.readFileSync("./cert/line-webhook-server.key"),
  cert: fs.readFileSync("./cert/line-webhook-server.crt"),
};
const server = https.createServer(options, app);

const port = process.env.PORT;
const line_access_token = process.env.LINE_ACCESS_TOKEN;
const hosxp_apikey = process.env.HOSXP_APIKEY;
const userdb_apikey = process.env.USER_DB_APIKEY;

app.post('/chatbot', async (request, response) => {
  const event = request.body.events[0];
  const LineUserID = event.source.userId;
  const replyToken = event.replyToken;
  const sentMessage = event.message.text;
  const replyMessage = [
    {
      type: "text",
      text: sentMessage,
    }
  ];
  await LineReply(replyMessage, replyToken, line_access_token);
  response.sendStatus(200);
})

server.listen(port, () => {
  console.log(`App listening on PORT: ${port}`);
});